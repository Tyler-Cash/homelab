app-template:
  controllers:
    main:
      type: deployment
      replicas: 3
      # -- Set the controller upgrade strategy
      # For Deployments, valid values are Recreate (default) and RollingUpdate.
      # For StatefulSets, valid values are OnDelete and RollingUpdate (default).
      # DaemonSets/CronJobs/Jobs ignore this.
      strategy: RollingUpdate

      rollingUpdate:
        unavailable: 2
        surge: 5

      containers:
        main:
          image:
            repository: ghcr.io/tyler-cash/tyler-bot-backend
            tag: latest@sha256:41847562b6580d91d4f5bcdcbe3aa9c5cbe109ff10b83c4029e834d126e30e95
          env:
            TZ: Australia/Sydney
            SPRING_CONFIG_ADDITIONAL-LOCATION: &secret_folder /secrets/config/
            SPRING_PROFILES_ACTIVE: prod
            SPRING_DATASOURCE_URL:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: jdbc-uri
            SPRING_DATASOURCE_USERNAME:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: username
            SPRING_DATASOURCE_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: password

  service:
    main:
      type: LoadBalancer
      controller: main
      ports:
        http:
          port: 8080

  persistence:
    storage:
      enabled: true
      storageClass: ceph-block
      accessMode: ReadWriteOnce
      size: 5Gi
    secrets:
      enabled: true
      type: secret
      name: tylerbot-secrets
      globalMounts:
        - path: *secret_folder

  resources:
    requests:
      cpu: 50m
      memory: 1Gi
    limits:
      memory: 2Gi
