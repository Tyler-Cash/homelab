app-template:
  controllers:
    main:
#      type: deployment
#      replicas: 3
#      # -- Set the controller upgrade strategy
#      # For Deployments, valid values are Recreate (default) and RollingUpdate.
#      # For StatefulSets, valid values are OnDelete and RollingUpdate (default).
#      # DaemonSets/CronJobs/Jobs ignore this.
#      strategy: RollingUpdate
#
#      rollingUpdate:
#        unavailable: 2
#        surge: 5
      containers:
        main:
          image:
            repository: ghcr.io/tyler-cash/tyler-bot-backend
            tag: latest@sha256:a9b68a0f729045ea194ab8df055f899a75e42b3c2d986c7a5158a1e083557a0b
          env:
            TZ: Australia/Sydney
            SPRING_CONFIG_ADDITIONAL-LOCATION: &secret_folder /secrets/config/
            SPRING_PROFILES_ACTIVE: prod
            SPRING_DATASOURCE_URL:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: jdbc-uri
            SPRING_DATASOURCE_USERNAME:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: username
            SPRING_DATASOURCE_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: tylerbot-database-app
                  key: password

  service:
    main:
      type: LoadBalancer
      controller: main
      ports:
        http:
          port: 8080

  persistence:
    secrets:
      enabled: true
      type: secret
      name: tylerbot-secrets
      globalMounts:
        - path: *secret_folder

  resources:
    requests:
      cpu: 50m
      memory: 1Gi
    limits:
      memory: 2Gi
