app-template:
  image:
    repository: gotify/server
    pullPolicy: IfNotPresent
    tag: "2.2.4"

  # See more environment variables in the gotify documentation
  # https://gotify.net/docs/config#environment-variables
  env:
    GOTIFY_SERVER_PORT: "80"
    GOTIFY_SERVER_KEEPALIVEPERIODSECONDS: "0"
    GOTIFY_SERVER_STREAM_PINGPERIODSECONDS: "45"
    GOTIFY_DATABASE_DIALECT: "sqlite3"
    GOTIFY_DATABASE_CONNECTION: "config/gotify.db"
    GOTIFY_PASSSTRENGTH: "10"
    GOTIFY_UPLOADEDIMAGESDIR: "config/images"
    GOTIFY_PLUGINSDIR: "data/plugins"

  service:
    main:
      ports:
        http:
          port: &port 80

  ingress:
    main:
      enabled: true
      annotations:
        cert-manager.io/cluster-issuer: "prod-issuer"
        hajimari.io/group: "Monitoring"
        kubernetes.io/ingress-allow-http: "false"
        kubernetes.io/ingress.class: "nginx"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "360000"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "360000"
        nginx.org/websocket-services: "gotify"
        nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8"
      hosts:
        - host: gotify.k8s.tylercash.dev
          paths:
            - path: /
              pathType: Prefix
              service:
                port: *port
      tls:
        - secretName: gotify-letsencrypt-certificate
          hosts:
            - gotify.k8s.tylercash.dev

  persistence:
    data:
      enabled: true
      storageClass: ceph-block
      accessMode: ReadWriteOnce
      size: 5Gi
  resources:
    limits:
      cpu: 80m
      memory: 64Mi
    requests:
      cpu: 50m
      memory: 32Mi
