authentik:
  replicas: 2

  worker:
    replicas: 2

  # Check that env variable isn't provided in normal env map. Sync will fail if it's duplicated
  envValueFrom:
    AUTHENTIK_POSTGRESQL__PASSWORD:
      secretKeyRef:
        key: password
        name: authentik.home-authentik.credentials.postgresql.acid.zalan.do
    AUTHENTIK_SECRET_KEY:
      secretKeyRef:
        key: secret_key
        name: authentik-secrets
    AUTHENTIK_EMAIL__FROM:
      secretKeyRef:
        key: from
        name: authentik-email
    AUTHENTIK_EMAIL__HOST:
      secretKeyRef:
        key: host
        name: authentik-email
    AUTHENTIK_EMAIL__PASSWORD:
      secretKeyRef:
        key: password
        name: authentik-email
    AUTHENTIK_EMAIL__USERNAME:
      secretKeyRef:
        key: username
        name: authentik-email

  env:
    AUTHENTIK_COOKIE_DOMAIN: tylercash.dev
    AUTHENTIK_EMAIL__PORT: 587
    AUTHENTIK_EMAIL__USE_TLS: true

  authentik:
    postgresql:
      host: home-authentik
    redis:
      host: authentik-redis-master

  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: "prod-issuer"
      hajimari.io/group: "Security"
      kubernetes.io/ingress-allow-http: "false"
      kubernetes.io/ingress.class: "nginx"
      nginx.ingress.kubernetes.io/proxy-buffer-size: 64k
      nginx.ingress.kubernetes.io/proxy-buffers-number: "8"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
      nginx.org/websocket-services: "authentik"
    hosts:
      - host: authentik.k8s.tylercash.dev
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: authentik-letsencrypt-certificate
        hosts:
          - authentik.k8s.tylercash.dev

  postgresql:
    enabled: false

  redis:
    enabled: true
    architecture: replication

  prometheus:
    serviceMonitor:
      create: true
    rules:
      create: true
